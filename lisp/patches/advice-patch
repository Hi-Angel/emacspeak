
diff --git a/lisp/emacspeak-preamble.el b/lisp/emacspeak-preamble.el
index 6e8fae032..238ed856a 100644
--- a/lisp/emacspeak-preamble.el
+++ b/lisp/emacspeak-preamble.el
@@ -168,20 +168,26 @@
       (setq ems-called-interactively-p (ad-get-arg 0)))
     ad-do-it))
 
-(defsubst ems-interactive-p ()
-  "Check  interactive flag.
-Return T if set and we are called from the advice for the current
- command. Turn off the flag once used."
-  (when ems-called-interactively-p      ; interactive call
-    (let ((caller (cl-second (backtrace-frame 1))) ; containing function name
-          (caller-advice ; advice wrapper of containing function
-           (ad-get-advice-info-field ems-called-interactively-p  'advicefunname))
-          (result nil))
-                                        ; T if called from our advice
-      (setq result (eq caller caller-advice))
-      (when result
-        (setq ems-called-interactively-p nil) ; turn off now that we used  it
-        result))))
+(advice-add 'defadvice :around #'ems--record-function-name)
+(defun ems--define-interactive-p (orig-mac funname args &rest body)
+  "Lexically redefine `ems-interactive-p' within BODY.
+The local definition expands to a call to `ems--interactive-p' to which it
+passes FUNNAME as argument."
+  (apply orig-mac funname args
+         (macroexp-unprogn
+          (macroexpand-all (macroexp-progn body)
+                           `((ems-interactive-p
+                              . ,(lambda () `(ems--interactively-p ',funname)))
+                             . ,macroexpand-all-environment)))))
+
+(defmacro ems-interactive-p ()
+  (error "ems-interactive-p used outside of defadvice!"))
+
+(defun ems--interactive-p (funname)
+  "Return non-nil if we're within an interactive call of FUNNAME."
+  (when (eq ems-called-interactively-p funname)
+    (setq ems-called-interactively-p nil) ; Turn off now that we used  it.
+    t))
 
 ;;}}}
 ;;{{{defsubst: ems--fastload:
